<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Login</title>
	<!-- Mobile Specific Metas -->
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<!-- Font-->
	<link rel="stylesheet" type="text/css" href="css/roboto-font.css">
	<link rel="stylesheet" type="text/css" href="fonts/font-awesome-5/css/fontawesome-all.min.css">
	<!-- Main Style Css -->
    <link rel="stylesheet" href="css/style.css"/>
</head>
<body class="form-v5">
	<div class="page-content">
		<div class="form-v5-content">
			<form class="form-detail" method="post">
				<h2>Login </h2>
				<div class="form-row">
					<label for="full-name">User Name</label>
					<input type="text" name="user-name" id="user-name" class="input-text" placeholder="User Name" required>
					<i class="fas fa-user"></i>
				</div>

				<div class="form-row">
					<label for="password">Password</label>
					<input type="password" name="password" id="password" class="input-text" placeholder="Your Password" required>
					<i class="fas fa-lock"></i>
				</div>
				<div class="form-row-last">
					<input type="submit" name="login" id="loginBtn" class="register" value="Login">
				</div>
                 <div style="display: flex;justify-content: center; align-items: center;">
					<a href="/signup.html">Sign Up</a>
				 </div>
			</form>
		</div>
	</div>
	<!-- we add the axios library to use for http ajax requests -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.19.0/axios.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/js-cookie@beta/dist/js.cookie.min.js"></script>
	<!-- login js -->
	<script>	
		 
		// function that sends the login request 
		async function login(){

		   //get the username and password from the input fields	
		   let username = document.getElementById("user-name").value
		   let password = document.getElementById("password").value
		   
		   //set the payload to be sent
		   let data = {
			   username : username,
			   password : password
		   }
            
		  try{
			//send the post request with the data to login endpoint  
			let response = await axios.post('/login',data);
			
			//the result returned wil be contained inside the response.data object
			if(response.data.message == "Authenticated"){

				Cookies.set('key',response.data.key)
				Cookies.set('userId',response.data.id)
				//if logged in change url to the home with id qury parameter
                window.location.href = "/home.html"
			}else{
                 alert("wrong credentials") 
			}

		  }catch(err){
            alert(JSON.stringify(err))
		  }
		}
		 
		//set ebent listener to login button
        document.getElementById("loginBtn").onclick = (e)=>{
			e.preventDefault() //prevents the default action of submitting the form
		
			login()
		}
		
		function loggedIn(){
			let key = Cookies.get('key')
			if(key){
				window.location.href = "/home.html"
			}
		}

		loggedIn()

	</script>
</body>
</html>